<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="S・BODY｜アクセスマップ">
  <meta property="og:description" content="初めての人でも迷わないアクセス案内（駐車場・入口あり）">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://areamap.onrender.com/areamap_sbodymorita">
  <meta property="og:image" content="https://areamap.onrender.com/static/img/sbodymorita.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="S・BODY｜アクセスマップ">
  <meta name="twitter:description" content="初めての人でも迷わないアクセス案内（駐車場・入口あり）">
  <meta name="twitter:image" content="https://areamap.onrender.com/static/img/sbodymorita.png">
  <title>S・BODY</title>

  <link rel="stylesheet" href="/static/css/areamap.css">
  <link rel="stylesheet" href="/static/css/areamap-sbody.css">
  <script>
    (() => {
      const p = new URLSearchParams(location.search);
      const mode = p.get("mode") || "page"; // page | embed | ig
      document.documentElement.setAttribute("data-areamap-view", mode);
    })();
  </script>
</head>

<body data-areamap-mode="default">

  <!-- =========================
    Map Wrapper（画像地図）
  ========================= -->
  <div id="map-wrapper">
    <div class="map-image-container">

      <!-- ベース地図画像 -->
      <img
        id="sbody-map-img"
        src="../static/img/sbodymorita.png"
        alt="S・BODY地図"
      >

      <!-- ホットスポット：駐車場 -->
      <button
        type="button"
        class="hotspot hotspot-parking"
        data-track="hotspot_parking_open"
        data-modal-img="../static/img/sbody_parking.png"
        data-modal-alt="S・BODY駐車場"
        aria-label="S・BODY駐車場を表示"
      ></button>

      <!-- ホットスポット：メニュー -->
      <button
        type="button"
        class="hotspot hotspot-menu"
        data-track="hotspot_menu_open"
        data-modal-img="../static/img/sbody_menu.png"
        data-modal-alt="S・BODYメニュー"
        aria-label="S・BODYメニューを表示"
      ></button>
    </div>
    <!-- =========================
      Google Map CTA（常時表示）
    ========================= -->
    <div class="areamap-cta">
      <a
        id="google-map-link"
        data-track="google_map_click"
        href="https://www.google.com/maps/place/%E3%83%91%E3%83%BC%E3%82%BD%E3%83%8A%E3%83%AB%E3%83%88%E3%83%AC%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0%EF%BC%86%E3%82%B3%E3%83%B3%E3%83%87%E3%82%A3%E3%82%B7%E3%83%A7%E3%83%8B%E3%83%B3%E3%82%B0%E3%82%B8%E3%83%A0+S%E3%83%BBBODY/@36.107092,136.224629,14z/data=!4m6!3m5!1s0x5ff8bf327aa10c13:0x92bcedb7ecd7e870!8m2!3d36.107092!4d136.2246294!16s%2Fg%2F11h3q6s_6s?hl=ja&entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D"
        target="_blank"
        rel="noopener"
        class="btn-route"
      >
        GoogleMapを見る
      </a>
    </div>
  </div>


  <!-- =========================
    Footer
  ========================= -->
  <footer class="areamap-footer">
    <!-- <small>AreaMap</small> -->
  </footer>

  <!-- =========================
    Modal（画像表示）
    - モーダル外クリック（overlay）で閉じる
  ========================= -->
  <div id="img-modal" class="img-modal" aria-hidden="true">
    <div class="img-modal__overlay" data-close></div>

    <div class="img-modal__content" role="dialog" aria-modal="true" aria-label="画像プレビュー">
      <button class="img-modal__close" type="button" data-close aria-label="閉じる">×</button>
      <img id="img-modal-target" src="" alt="">
    </div>
  </div>

  <!-- =========================
    JS（ホットスポット→モーダル）
  ========================= -->
  <script>
    (function () {
      const modal = document.getElementById("img-modal");
      const modalImg = document.getElementById("img-modal-target");
      const hotspots = document.querySelectorAll(".hotspot");

      function openModal(src, alt) {
        if (!src) return;
        modalImg.src = src;
        modalImg.alt = alt || "";
        modal.classList.add("is-open");
        modal.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
      }

      function closeModal() {
        modal.classList.remove("is-open");
        modal.setAttribute("aria-hidden", "true");
        modalImg.src = "";
        modalImg.alt = "";
        document.body.style.overflow = "";
      }

      hotspots.forEach((btn) => {
        btn.addEventListener("click", () => {
          const src = btn.getAttribute("data-modal-img");
          const alt = btn.getAttribute("data-modal-alt");
          openModal(src, alt);
        });
      });

      // モーダル外（overlay / closeボタン）クリックで閉じる
      modal.addEventListener("click", (e) => {
        if (e.target && e.target.matches("[data-close]")) {
          closeModal();
        }
      });

      // Escでも閉じる（任意）
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && modal.classList.contains("is-open")) {
          closeModal();
        }
      });
    })();
  </script>
    <!-- =========================
    JS（計測）
    - クリックイベントを /api/metrics/log に送信
  ========================= -->
  <script>
    (function () {
      // ----------------------------
      // 設定
      // ----------------------------
      const ENDPOINT = "/api/metrics/log";

      // URLパラメータ（媒体別/投稿別計測）
      const qs = new URLSearchParams(location.search);
      const ref = qs.get("ref") || "";       // instagram / hp / flyer など
      const post = qs.get("post") || "";     // reel_001 など
      const variant = qs.get("variant") || "";

      // 簡易セッションID（匿名。localStorageで維持）
      function getOrCreateSessionId() {
        const key = "areamap_session_id";
        let id = localStorage.getItem(key);
        if (!id) {
          id = (crypto?.randomUUID?.() || ("sid_" + Math.random().toString(36).slice(2) + Date.now()));
          localStorage.setItem(key, id);
        }
        return id;
      }

      function getClientMeta() {
        const nav = navigator || {};
        const scr = window.screen || {};
        const conn = nav.connection || nav.mozConnection || nav.webkitConnection;

        const mmPointerCoarse = window.matchMedia ? window.matchMedia("(pointer: coarse)").matches : null;
        const mmHoverNone = window.matchMedia ? window.matchMedia("(hover: none)").matches : null;
        const mmReducedMotion = window.matchMedia ? window.matchMedia("(prefers-reduced-motion: reduce)").matches : null;
        const mmColorScheme = window.matchMedia
          ? (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark"
             : (window.matchMedia("(prefers-color-scheme: light)").matches ? "light" : null))
          : null;

        return {
          page_url: location.href,
          page_path: location.pathname,
          referrer: document.referrer || "",
          title: document.title || "",

          ref, post, variant,

          session_id: getOrCreateSessionId(),

          user_agent: nav.userAgent || "",
          language: nav.language || "",
          languages: Array.isArray(nav.languages) ? nav.languages : [],
          platform: nav.platform || "",

          timezone: (() => {
            try { return Intl.DateTimeFormat().resolvedOptions().timeZone || ""; } catch (e) { return ""; }
          })(),
          tz_offset_min: new Date().getTimezoneOffset(),

          screen_width: scr.width || null,
          screen_height: scr.height || null,
          viewport_width: window.innerWidth || null,
          viewport_height: window.innerHeight || null,
          device_pixel_ratio: window.devicePixelRatio || null,
          color_depth: scr.colorDepth || null,

          max_touch_points: nav.maxTouchPoints ?? null,
          pointer_coarse: mmPointerCoarse,
          hover_none: mmHoverNone,

          device_memory_gb: nav.deviceMemory ?? null,
          hardware_concurrency: nav.hardwareConcurrency ?? null,

          connection_effective_type: conn?.effectiveType || null,
          connection_rtt_ms: conn?.rtt ?? null,
          connection_downlink_mbps: conn?.downlink ?? null,
          connection_save_data: conn?.saveData ?? null,

          cookies_enabled: nav.cookieEnabled ?? null,
          do_not_track: nav.doNotTrack ?? null,
          prefers_reduced_motion: mmReducedMotion,
          prefers_color_scheme: mmColorScheme
        };
      }

      async function sendMetric(event_name, metric_id, extra = {}) {
        const payload = {
          event_name,
          metric_id,
          extra: {
            ...extra,
            ...getClientMeta()
          }
        };

        // 失敗してもUXを壊さない
        try {
          // keepalive: ページ遷移直前でも送れる（対応ブラウザのみ）
          await fetch(ENDPOINT, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
            keepalive: true
          });
        } catch (e) {
          // noop
        }
      }

      // ----------------------------
      // イベント紐付け
      // ----------------------------
      const mapImg = document.getElementById("sbody-map-img");
      const googleLink = document.getElementById("google-map-link");
      const parkingBtn = document.querySelector(".hotspot-parking");
      const menuBtn = document.querySelector(".hotspot-menu");

      // ページ表示（任意）
      sendMetric("view", "areamap_page_view");

      if (mapImg) {
        mapImg.addEventListener("click", () => sendMetric("click", "map_image_click"));
      }
      if (parkingBtn) {
        parkingBtn.addEventListener("click", () => sendMetric("click", "hotspot_parking_open", {
          modal_img: parkingBtn.getAttribute("data-modal-img") || ""
        }));
      }
      if (menuBtn) {
        menuBtn.addEventListener("click", () => sendMetric("click", "hotspot_menu_open", {
          modal_img: menuBtn.getAttribute("data-modal-img") || ""
        }));
      }
      if (googleLink) {
        // 遷移前に送る（target=_blankでもOK）
        googleLink.addEventListener("click", () => sendMetric("click", "google_map_click", {
          href: googleLink.href
        }));
      }
    })();

    (function () {
    const tracker = window.AreamapMetrics.createTracker({
      endpoint: "/api/metrics/log"
    });

    // 1) 到達（=リンククリック後の到達結果）
    tracker.trackPageView("areamap_page_view");

    // 2) data-track を付けた要素は全部自動で click 計測
    tracker.bindAutoClicks();

    // 3) 個別に明示したいものだけ（任意）
    const mapImg = document.getElementById("sbody-map-img");
    if (mapImg) {
      mapImg.addEventListener("click", () => tracker.track("click", "map_image_click"));
    }
  })();
  </script>
  <script src="/static/js/areamap_metrics.js"></script>
</body>
</html>





